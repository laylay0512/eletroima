<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulação 3D - Indução Eletromagnética</title>
    <style>
        body { margin: 0; background-color: #ffffff; font-family: sans-serif; overflow: hidden; }
        #label { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="label">
        <h1>Indução de Faraday</h1>
        <p>Usa o rato para rodar e o scroll para zoom.</p>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. Configuração da Cena e Câmara
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf5f5f5);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(8, 5, 10);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);

        // 2. Iluminação
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(10, 10, 10);
        scene.add(dirLight);

        // 3. Materiais
        const metalGray = new THREE.MeshStandardMaterial({ color: 0x777777, metalness: 0.7, roughness: 0.3 });
        const copperMat = new THREE.MeshStandardMaterial({ color: 0xb87333, metalness: 0.8, roughness: 0.2 });
        const wireMat = new THREE.MeshStandardMaterial({ color: 0xdaa520 });
        const galvanoYellow = new THREE.MeshStandardMaterial({ color: 0xffd700 }); // Amarelo do galvanômetro

        // 4. Construção do Eletroíman (Formato em U)
        const group = new THREE.Group();

        const vBar = new THREE.Mesh(new THREE.BoxGeometry(0.8, 3.5, 0.8), metalGray);
        vBar.position.set(-2, 0, 0);
        group.add(vBar);

        const topHBar = new THREE.Mesh(new THREE.BoxGeometry(3.5, 0.8, 0.8), metalGray);
        topHBar.position.set(-0.65, 1.35, 0);
        group.add(topHBar);

        const botHBar = new THREE.Mesh(new THREE.BoxGeometry(3.5, 0.8, 0.8), metalGray);
        botHBar.position.set(-0.65, -1.35, 0);
        group.add(botHBar);

        const poleGeom = new THREE.CylinderGeometry(0.7, 0.7, 0.6, 32);
        const poleS = new THREE.Mesh(poleGeom, metalGray);
        poleS.position.set(1, 0.75, 0);
        group.add(poleS);

        const poleN = new THREE.Mesh(poleGeom, metalGray);
        poleN.position.set(1, -0.75, 0);
        group.add(poleN);

        // 5. A Bobina (Enrolamento de fios)
        const coilGeom = new THREE.TorusGeometry(0.6, 0.08, 16, 100);
        for(let i = 0; i < 8; i++) {
            const coilTurn = new THREE.Mesh(coilGeom, wireMat);
            coilTurn.rotation.x = Math.PI / 2;
            coilTurn.position.set(-2, -1 + (i * 0.3), 0);
            group.add(coilTurn);
        }

        // 6. A Espira Central (Indução)
        const loopGeom = new THREE.TorusGeometry(0.5, 0.04, 16, 100);
        const inductionLoop = new THREE.Mesh(loopGeom, copperMat);
        inductionLoop.rotation.x = Math.PI / 2;
        inductionLoop.position.set(1, 0, 0);
        group.add(inductionLoop);

        // --- GALVANÔMETRO (Adicionado conforme a imagem) ---
        const galvano = new THREE.Group();
        
        // Caixa Amarela
        const body = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1.8, 1), galvanoYellow);
        galvano.add(body);

        // Visor Circular
        const displayGeom = new THREE.CircleGeometry(0.5, 32);
        const displayMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const display = new THREE.Mesh(displayGeom, displayMat);
        display.position.set(0, 0.2, 0.51);
        galvano.add(display);

        // Ponteiro Preto
        const pointerGeom = new THREE.BoxGeometry(0.03, 0.45, 0.01);
        pointerGeom.translate(0, 0.22, 0); // Ajusta o ponto de rotação para a base
        const pointer = new THREE.Mesh(pointerGeom, new THREE.MeshBasicMaterial({ color: 0x000000 }));
        pointer.position.set(0, -0.1, 0.52);
        galvano.add(pointer);

        galvano.position.set(3.5, -1, 1); // Posicionado à direita e à frente
        group.add(galvano);

        // Fios de conexão (Pretos)
        const wireCurve = new THREE.QuadraticBezierCurve3(
            new THREE.Vector3(1.5, 0, 0),    // Saída da espira
            new THREE.Vector3(2.5, -1, 0.5), // Meio do caminho
            new THREE.Vector3(3.5, -0.5, 1)  // Entrada no galvanômetro
        );
        const wireTube = new THREE.Mesh(new THREE.TubeGeometry(wireCurve, 20, 0.03, 8), new THREE.MeshBasicMaterial({color: 0x222222}));
        group.add(wireTube);

        scene.add(group);

        // 7. Animação
        function animate() {
            requestAnimationFrame(animate);
            
            const time = Date.now() * 0.003;
            const motion = Math.sin(time);

            // Movimento da espira
            inductionLoop.position.y = motion * 0.1;
            
            // Deflexão do ponteiro sincronizada com o movimento da espira
            pointer.rotation.z = -motion * 1.2; 
            
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
